$open-anim-duration: 0.5s;

#expl-window-container {
    width: 0;
    height: 0;
    position: fixed;
    background-color: white;
    box-shadow: 7px 8px 20px 0 rgba(0 0 0 / 0.5);
    z-index: 10;

    &.grow {
        animation: $open-anim-duration grow forwards;
    }

    @mixin fade-in($name, $from, $to) {
        @keyframes #{$name} {
            from {
                opacity: $from
            }
            to {
                opacity: $to
            }
        }
    }

    @keyframes fade-out {
        from {
            left: 50%;
            top: 50%;
            opacity: 1
        }
        to {
            left: 50%;
            top: 50%;
            opacity: 0
        }
    }

    &.fade-out {
        width: 40em;
        height: 28em;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        animation: 5s fade-out forwards;
    }

    #expl-window-bg {
        position: absolute;
        background-image: url("../public/bg.jpg");
        background-size: 79em;
        opacity: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;

        @include fade-in(fade-in-bg, 0,  0.3);

        animation: $open-anim-duration * 2 fade-in-bg forwards;
    }

    #expl-window {
        width: 100%;
        height: 100%;
        position: absolute;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        opacity: 0;
        $color-change-dur: 0.5s;

        @include fade-in(fade-in-fg,  0, 1);
        animation: $open-anim-duration fade-in-fg forwards;

        #close-button {
            position: absolute;
            font-size: 2.5rem;
            line-height: 2rem;
            margin: 0;
            top: 2rem;
            right: 2rem;
            font-weight: 500;
            transform: scaleY(0.8);
            transition: transform 0.3s;

            &:hover {
                transform: scale(1.25, 1);
                cursor: pointer;
            }
        }

        .headline-divisor, .headline-rule {
            font-size: 2.5em;
            font-weight: 700;
            line-height: 0;
            margin-bottom: 1.1em;
            margin-top: 0.7em;
        }

        #explanation {
            font-size: 1.1em;
            font-weight: 400;
            margin-bottom: 0.5em;
            width: 90%;
            text-align: center;
        }

        h1 {
            font-size: 3em;
        }

        .divisor, .not-divisor, .division-row, #demo7 h1 {
            line-height: 0.4em;
        }

        #demonstration1 {
            &.divisor span {
                animation: $color-change-dur color-change-lightgreen forwards 1s;
            }

            &.not-divisor span {
                animation: $color-change-dur color-change-red forwards 1s;
            }
        }

        #demonstrationDigitSum, #demo7 {
            flex-direction: column-reverse;
            justify-content: flex-end;
        }

        #demo7 {
            justify-content: flex-start;

            h1 {
                font-size: 2.5em;
            }
        }

        #demonstrationLastNDigits {
            flex-direction: column;
            justify-content: flex-start;

            &.single-row {
                overflow: hidden;
            }
        }

        #composite-demo {
            flex-direction: column;

            h1 {
                font-size: 2.5em;
            }

            .child.single-row {
                height: 35%;
            }

            .child {
                &#demonstrationLastNDigits {
                    justify-content: flex-end;
                }

                &:not(&#demonstrationLastNDigits) {
                    justify-content: initial;
                }

                &:nth-of-type(1) {
                    margin-top: -1em;
                    margin-bottom: 1em;
                }

                height: 60%;
            }
        }

        #demonstrationLastNDigits, #demonstrationDigitSum, #demo7, #composite-demo {
            width: 85%;
            display: flex;
            align-items: center;

            &:not(&.single-row):not(&.child) {
                height: 40%;
            }
        }

        #demonstrationLastNDigits, #demonstrationDigitSum, #demo7 {
            $anim-dur: 3s;
            $margin-condensed: -0.2em;
            $margin-extended: 0.1em;
            $margin-extra-condensed: -1.1em;
            $margin-extra-extended: 0.3em;

            overflow: auto;

            @mixin translate-left($name, $from, $to) {
                @keyframes #{$name} {
                    from {
                        margin-right: $from;
                    }
                    to {
                        margin-right: $to;
                    }
                }
            }

            @mixin translate-left-right($name, $from, $to) {
                @keyframes #{$name} {
                    from {
                        margin-right: $from;
                        margin-left: $from;
                    }
                    to {
                        margin-left: $to;
                        margin-right: $to;
                    }
                }
            }

            @for $i from 0 to 20 {
                #row#{$i} {
                    margin: 0;
                    opacity: 0;
                    animation: $anim-dur * 0.67 fade-in-slide-down forwards $i * $anim-dur;

                    &.demonstrationLastDigit {
                        &.divisor span {
                            animation: $color-change-dur * 2 color-change-lightgreen-translate forwards $i * $anim-dur + 1s;
                            &#sole-digit {
                                animation: $color-change-dur * 2 color-change-lightgreen forwards $i * $anim-dur + 1s;
                            }
                        }

                        &.not-divisor span {
                            animation: $color-change-dur * 2 color-change-red-translate forwards $i * $anim-dur + 1s;
                            &#sole-digit {
                                animation: $color-change-dur * 2 color-change-red forwards $i * $anim-dur + 1s;
                            }
                        }
                    }

                    &.division-row span {
                        margin-left: 0.3em;
                        animation: $anim-dur * 0.17 * 3 reveal-operators forwards ($i + 0.83) * $anim-dur * 0.5;
                    }

                    #hidden-equation-left-part {
                        margin-right: -0.4em;
                        margin-left: -0.4em;
                    }

                    #left-most-digits {
                        margin-right: -1.4em;
                        @include translate-left(translate-left-large, -1.4em, 0.3em);
                        animation: $anim-dur * 0.17 translate-left-large forwards ($i + 0.67) * $anim-dur;
                    }

                    #right-most-digit {
                        margin-left: -1.0em;
                        margin-right: $margin-extra-condensed;
                        @include translate-left-right(translate-left-right-large, -1.0em, $margin-extra-extended);
                        animation: $anim-dur * 0.17 translate-left-right-large forwards ($i + 0.67) * $anim-dur;
                    }

                    .operator, #hidden-equation-left-part, #hidden-equation-right-part {
                        animation: $anim-dur * 0.17 reveal-operators forwards ($i + 0.83) * $anim-dur;
                    }

                    &.division-row span, .operator, #hidden-equation-left-part, #hidden-equation-right-part {
                        opacity: 0;
                    }

                    // Left-most digit (not single-digit number)
                    .digit:first-child:not(:last-child) {
                        @include translate-left(translate-left-small, $margin-condensed, $margin-extended);
                        animation: $anim-dur * 0.17 translate-left-small forwards ($i + 0.67) * $anim-dur;
                    }

                    .digit:first-child:not(:last-child) {
                        margin-right: $margin-condensed;
                    }

                    // Mid-digit
                    .digit:not(:last-child):not(:first-child) {
                        margin-left: $margin-condensed;
                        margin-right: $margin-condensed;
                        @include translate-left-right(translate-left-right-small, $margin-condensed, $margin-extended);
                        animation: $anim-dur * 0.17 translate-left-right-small forwards ($i + 0.67) * $anim-dur;
                    }

                    // Right-most digit (not single-digit)
                    .digit:last-child:not(:first-child) {
                        margin-left: $margin-condensed;
                        animation: $anim-dur * 0.17 translate-right forwards ($i + 0.67) * $anim-dur;
                    }

                    // Single-digit numbers
                    &.divisor .digit:only-child, &.divisor.demo-last-row span {
                        animation: $color-change-dur color-change-lightgreen forwards ($i + 0.84) * $anim-dur;
                    }
                    &.not-divisor .digit:only-child, &.not-divisor.demo-last-row span {
                        animation: $color-change-dur color-change-red forwards ($i + 0.84) * $anim-dur;
                    }
                }
            }
        }

        @keyframes translate-right {
            from {
                margin-left: -15%;
            }
            to {
                margin-left: 10%;
            }
        }

        @keyframes reveal-operators {
            0% {
                opacity: 0;
            }
            50% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }

        @keyframes fade-in-slide-down {
            0% {
                margin: 0;
                opacity: 0;
            }
            50% {
                margin-top: 0.7em;
                margin-bottom: 0.1em;
                opacity: 0;
            }
            100% {
                margin-top: 0.7em;
                margin-bottom: 0.1em;
                opacity: 1;
            }
        }
    }

    @mixin color-change-translate($color, $margin-left) {
        0% {
            margin-left: 0;
            color: black;
        }
        50% {
            color: black;;
            margin-left: #{$margin-left}em;
        }
        100% {
            color: $color;
            margin-left: #{$margin-left}em;
        }
    }

    @mixin color-change($color) {
        from {
            color: black;
        }
        to {
            color: $color;
        }
    }

    @keyframes color-change-lightgreen-translate {
        @include color-change-translate(lightgreen, 0.5);
    }

    @keyframes color-change-red-translate {
        @include color-change-translate(red, 0.5);
    }

    @keyframes color-change-lightgreen {
        @include color-change(lightgreen);
    }

    @keyframes color-change-red {
        @include color-change(red);
    }
}

@keyframes grow {
    from {
        width: 0;
        height: 0;
    }
    to {
        width: 40em;
        height: 28em;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
    }
}

@keyframes slide-in {
    from {
        left: 100%;
    }
    to {
        left: 0;
    }
}

@media (max-width: 650px), (max-height: 650px) {
    #expl-window-container {
        width: 100%;
        height: 100%;
        top: 0 !important;

        &.fade-out {
            width: 100%;
            height: 100%;
            left: 0 !important;
            top: 0 !important;
            transform: translate(0, 0);
            animation: 0.5s fade-out forwards;
        }

        &.grow {
            animation: $open-anim-duration slide-in forwards;
        }

        #expl-window-bg {
            opacity: 0.3;
            animation: none;
        }

        #expl-window {
            animation: none;
            opacity: 1;

            .headline-divisor, .headline-rule {
                padding: 0 1rem;
                line-height: 2.5rem;
                margin-top: 0;
                text-align: center;
            }

            .headline-divisor {
                margin-bottom: 1rem;
            }

            .headline-rule {
                margin-bottom: 1.5rem;
            }

            #demonstrationDigitSum,  #demonstrationLastNDigits {
                height: auto !important;
            }

            #demonstrationLastNDigits {
                h1 {
                    line-height: 3rem;

                    &.multi-row {
                        font-size: 2.3rem;
                    }
                }
            }
        }
    }
}
